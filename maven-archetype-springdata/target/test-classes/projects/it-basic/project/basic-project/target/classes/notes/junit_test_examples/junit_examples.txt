package com.wallstft.workflow.dal;

import java.util.ArrayList;
import java.util.List;

import org.hibernate.SessionFactory;
import org.hibernate.StatelessSession;
import org.hibernate.Transaction;
import org.junit.Ignore;
import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import com.wallstft.workflow.dal.matching.Matching;
import com.wallstft.workflow.dal.repos.DataProviderRepository;
import com.wallstft.workflow.dal.repos.ShardStorageRepository;
import com.wallstft.workflow.dal.repos.UserRepository;
import com.wallstft.workflow.dal.repos.matching.MatchingRepository;



@RunWith(SpringRunner.class)
@SpringBootTest
class CsmApplicationTests {
	

	@Autowired
	ShardStorageRepository repository ;
	
	@Autowired
	MatchingRepository matching_repository ;
	
	
	@Autowired
	UserRepository user_repository ;
	
	@Autowired
	DataProviderRepository dp_repository;

	@Ignore
	@Test
	public void testShardStorage() {
		
    	ShardStorage s = new ShardStorage();
        
    	s.setShard_id(1);
    	s.setSize(0);
    	s.setSeek(2000);
    	
    	repository.save(s);
		
	}
	
	@Ignore
	@Test
	public void testLeftJoin()
	{
		List<Object[]> list = repository.getActiveShards();
		
		if ( list != null ) {
			for ( Object[] l : list ) {
				if ( l != null ) {
					for ( Object o : l ) {
						if ( o != null ) { 
							System.out.print(String.format("%s ", o.toString()));
						}
					}
					System.out.println("");
				}
			}
		}	
	}
	
	@Ignore
	@Test
	public void testMatching()
	{

		int idx = matching_repository.getMax()+1;
		List<Matching> list = new ArrayList();
		for (int x =0;x<100; x++ ) {

			Matching m = new Matching();
			m.setMatch_id(idx);
			m.setVendor_unique_id(String.format("VendorString_%d", idx));
			
			idx++;
			list.add(m);
			
			if ( list != null && list.size() % 1000 == 0 ) {
				matching_repository.saveAll(list);
				list.clear();
			}
			
		}
		if ( list != null && list.size() > 0 ) {
			matching_repository.saveAll(list);
		}
		
	}
	
	@Test 
	public void test_DataProvider()
	{
		
		DataProvider dp = dp_repository.findByDataProviderName("Bloomberg"); 
				
		if ( dp == null ) {		
			dp = new DataProvider();
			dp.setDataProviderName("Bloomberg");
			dp_repository.save(dp);
		}
		
		System.out.println (String.format ( "Data Provider %s %d", dp.getDataProviderName(), dp.getLicense_id()));		
	}
	
	@Ignore
	@Test
	public void TestStatelessSessions()
	{
	}


	private void foreach(Class<Object[]> class1) {
		// TODO Auto-generated method stub
		
	}

}
